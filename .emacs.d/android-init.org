#+TITLE: scotts emacs configuration
#+AUTHOR: Scott Stavinoha
#+PROPERTY: header-args:emacs-lisp :tangle ~/.emacs.d/android-init.el

* initialize package-management

#+begin_src emacs-lisp
  ;; Bootstrap straight.el
  (defvar bootstrap-version)
  (let ((bootstrap-file
         (expand-file-name "straight/repos/straight.el/bootstrap.el" user-emacs-directory))
        (bootstrap-version 6))
    (unless (file-exists-p bootstrap-file)
      (with-current-buffer
          (url-retrieve-synchronously
           "https://raw.githubusercontent.com/radian-software/straight.el/develop/install.el"
           'silent 'inhibit-cookies)
        (goto-char (point-max))
        (eval-print-last-sexp)))
    (load bootstrap-file nil 'nomessage))

  ;; Install use-package via straight
  (straight-use-package 'use-package)

  ;; Make use-package use straight by default
  (setq straight-use-package-by-default t)
  (straight-use-package 'org)
#+end_src

* org
#+begin_src emacs-lisp
  (use-package org
    :straight nil
    :config
    (setq org-directory "~/storage/shared/org"
          org-agenda-files (list "~/storage/shared/org/denote/")
          org-clock-persist 'history
          org-export-with-section-numbers nil
          org-hide-block-startup t
          org-src-window-setup 'current-window
          org-confirm-babel-evaluate 'my-org-confirm-babel-evaluate))

  ;; Org babel
  (use-package ob-http)
  (use-package ox-gfm :ensure t)

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((shell . t) (emacs-lisp . t) (latex . t) (js . t) (python . t) (http . t)))

  (defun my-org-confirm-babel-evaluate (lang body)
    (not (member lang '("node" "http" "python" "emacs-lisp" "graphql" "sh" "bash" "js" "shell" "javascript" "inline-js"))))

  (add-to-list 'org-src-lang-modes '("inline-js" . javascript))
  (defvar org-babel-default-header-args:inline-js
    '((:results . "html") (:exports . "results")))
  (defun org-babel-execute:inline-js (body _params)
    (format "<script type=\"text/javascript\">\n%s\n</script>" body))

  ;; Org publishing
  (setq org-html-metadata-timestamp-format "%a %Y/%m/%d"
        org-html-prefer-user-labels t
        org-export-with-broken-links t
        org-html-postamble t
        org-html-postamble-format
        '(("en" "<p class=\"date\">Created: %d </p><p class=\"updated\">Last Updated: %C</p><p class=\"creator\">Generated by %c</p>")))

  (setq org-publish-project-alist
        '(("org-pages" :base-directory "~/storage/shared/org/roam/daily"
           :base-extension "org"
           :publishing-directory "/ssh:root@lantana.io:/var/www/html/org/daily"
           :recursive t :publishing-function org-html-publish-to-html
           :headline-levels 4 :auto-preamble t
           :exclude "daily/work/\\|iFIT\\|lantana.index.org"
           :auto-sitemap t :sitemap-filename "index.org"
           :sitemap-title "Hello" :sitemap-sort-files anti-chronologically
           :html-head-include-scripts t
           :html-head-extra "<script src=\"../../test.js\"></script>")
          ("lantana-index" :base-directory "~/storage/shared/org/"
           :base-extension "org"
           :publishing-directory "/ssh:root@lantana.io:/var/www/html/"
           :publishing-function org-html-publish-to-html)
          ("js" :base-directory "~/storage/shared/org/js"
           :base-extension "js"
           :publishing-directory "/ssh:root@lantana.io:/var/www/html/"
           :recursive t :publishing-function org-publish-attachment)
          ("org-attachments" :base-directory "~/Dropbox/org/roam/daily/data"
           :base-extension "png\\|jpg\\|gif\\|css\\|js"
           :publishing-directory "/ssh:root@lantana.io:/var/www/html/org/daily/data"
           :publishing-function org-publish-attachment :recursive t)
          ("LANtana" :components ("org-pages" "lantana-index" "org-attachments"))))

  ;; Org-download
  (use-package org-download
    :init
    (setq org-download-method 'attach
          org-download-screenshot-method "grim -g \"$(slurp)\" /tmp/temp.png && convert -filter Cubic -resize 500 /tmp/temp.png %s"))

  (defun my/gptel-image-download-setup ()
    (interactive)
    (when (derived-mode-p 'org-mode)
      (with-eval-after-load 'org-download
        (setq-local org-download-image-dir
  		  (file-name-as-directory (concat (file-name-as-directory temporary-file-directory) "gptel")))
        (setq-local org-download-heading-lvl nil)
        )
      )
    )
  (add-hook 'gptel-mode-hook #'my/gptel-image-download-setup)
#+end_src

** denote

#+begin_src emacs-lisp
  (use-package denote
    :straight t
    :bind (("C-c n n" . denote)              ; Create new note
           ("C-c n f" . denote-open-or-create) ; Find/create note
           ("C-c n l" . denote-link)           ; Insert link
           ("C-c n L" . denote-backlinks)      ; Show backlinks
           ("C-c n r" . denote-rename-file)    ; Rename with new title/keywords
           ("C-c n R" . denote-rename-file-using-front-matter))
    :config
    ;; Main notes directory (keeping separate from journal)
    (setq denote-directory (expand-file-name "~/storage/shared/org/denote"))

    ;; File naming
    (setq denote-file-type 'org)           ; Use org format
    (setq denote-known-keywords '("project" "ifit" "work" "personal"))
    (setq denote-infer-keywords t)         ; Suggest keywords from existing files
    (setq denote-prompts '(title keywords)) ; What to ask for when creating


    ;; Allow subdirectories
    (setq denote-allow-subdirectories t)

    ;; History
    (add-to-list 'savehist-additional-variables 'denote-history))


  ;; Optional: Work notes
  (defun my/denote-work ()
    "Create or open today's work journal entry."
    (interactive)
    (let ((denote-directory (expand-file-name "~/storage/shared/org/denote/work"))
          (denote-file-name-title "work"))
      (denote-create-note)))

  (global-set-key (kbd "C-c n W") #'my/denote-work)

  (use-package denote-journal
    :straight t
    :bind (("C-c n J" . denote-journal-new-entry)     ; Today's journal
           ("C-c n j" . denote-journal-new-or-existing-entry)) ; Find journal entry
    :config
    ;; Journal lives in separate directory
    (setq denote-journal-directory (expand-file-name "~/storage/shared/org/denote/journal"))

    ;; Simpler journal file names (no signature, no keywords by default)
    (setq denote-journal-file-name-title "journal")

    ;; Daily journal (could be 'weekly or 'monthly)
    (setq denote-journal-frequency 'daily))


  ;; Optional: Work journal (separate from personal)
  ;; You can call this function or bind it
  (defun my/denote-journal-work ()
    "Create or open today's work journal entry."
    (interactive)
    (let ((denote-journal-directory (expand-file-name "~/storage/shared/org/denote/work/journal"))
          (denote-journal-file-name-title "work"))
      (denote-journal-new-or-existing-entry)))

  (global-set-key (kbd "C-c n w") #'my/denote-journal-work)


  ;; Consult integration (if you use consult)
  (with-eval-after-load 'consult
    (defun my/consult-denote ()
      "Find denote file with consult."
      (interactive)
      (consult-find denote-directory))

    (defun my/consult-denote-grep ()
      "Grep denote files with consult."
      (interactive)
      (consult-ripgrep denote-directory)))
#+end_src
#+RESULTS:

* /Local Variables/
# Local Variables:
# eval: (add-hook 'after-save-hook (lambda () (org-babel-tangle)) nil t)
# End:

#!/bin/bash
# Clipboard picker with fzf preview

SELECTION=$(cliphist list | fzf \
    --height=100% \
    --layout=reverse \
    --no-sort \
    --preview='
      if cliphist decode <<< {} | file - | grep -qi image; then
        cliphist decode <<< {} | chafa --format=sixel -s ${FZF_PREVIEW_COLUMNS}x${FZF_PREVIEW_LINES}
      else
        cliphist decode <<< {}
      fi
    ' \
    --preview-window=right:50%:wrap \
    --bind='ctrl-d:execute(cliphist delete <<< {})+reload(cliphist list)')

[[ -n "$SELECTION" ]] && { cliphist decode <<< "$SELECTION" | wl-copy; sleep 0.02; }

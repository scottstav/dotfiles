#!/bin/bash
# Send a calendar event reminder notification with optional Join Meeting button.
# Usage: gcal-notify <summary> <minutes> <urgency> [meeting_url]

summary="$1"
minutes="$2"
urgency="${3:-normal}"
meeting_url="$4"

if [[ "$minutes" -le 2 ]]; then
    prefix="Starting now"
else
    prefix="In ${minutes} min"
fi

args=(
    --app-name "Google Calendar"
    --urgency "$urgency"
    --icon "x-office-calendar"
    --category "calendar"
)

if [[ -n "$meeting_url" ]]; then
    # "default" action makes clicking the notification body itself open the meeting
    action=$(notify-send "${args[@]}" "$prefix: $summary" "Click to join" \
        --action "default=Join Meeting" --wait 2>/dev/null)
    if [[ "$action" == "default" ]]; then
        xdg-open "$meeting_url" &
    fi
else
    notify-send "${args[@]}" "$prefix: $summary"
fi
